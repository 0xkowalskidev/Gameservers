<div class="max-w-4xl mx-auto">
  <div class="flex justify-between items-center mb-6">
    <h2 class="text-2xl font-bold text-gray-900">{{.Gameserver.Name}}</h2>
    <a href="/" class="bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded-md">‚Üê Back</a>
  </div>
  
  <div class="grid md:grid-cols-2 gap-6">
    <div class="bg-white shadow rounded-lg p-6">
      <h3 class="text-lg font-semibold mb-4">Information</h3>
      <dl class="space-y-2 text-sm">
        <div class="flex justify-between"><dt class="font-medium">Status:</dt><dd class="{{if eq .Gameserver.Status "running"}}text-green-600{{else if eq .Gameserver.Status "stopped"}}text-red-600{{else}}text-yellow-600{{end}} font-medium">{{.Gameserver.Status}}</dd></div>
        <div class="flex justify-between"><dt class="font-medium">Game Type:</dt><dd>{{.Gameserver.GameType}}</dd></div>
        <div class="flex justify-between"><dt class="font-medium">Port:</dt><dd>{{.Gameserver.Port}}</dd></div>
        <div class="flex justify-between"><dt class="font-medium">Memory Limit:</dt><dd>{{.Gameserver.MemoryGB}} GB</dd></div>
        {{if gt .Gameserver.CPUCores 0.0}}<div class="flex justify-between"><dt class="font-medium">CPU Limit:</dt><dd>{{.Gameserver.CPUCores}} cores</dd></div>{{else}}<div class="flex justify-between"><dt class="font-medium">CPU Limit:</dt><dd>Unlimited</dd></div>{{end}}
        <div class="flex justify-between"><dt class="font-medium">Image:</dt><dd class="truncate">{{.Gameserver.Image}}</dd></div>
        <div class="flex justify-between"><dt class="font-medium">Container:</dt><dd class="font-mono text-xs truncate">{{.Gameserver.ContainerID}}</dd></div>
        {{if .Gameserver.VolumeInfo}}
        <div class="flex justify-between"><dt class="font-medium">Volume:</dt><dd class="font-mono text-xs">{{.Gameserver.VolumeInfo.Name}}</dd></div>
        <div class="flex justify-between"><dt class="font-medium">Host Path:</dt><dd class="font-mono text-xs truncate">{{.Gameserver.VolumeInfo.MountPoint}}</dd></div>
        {{end}}
      </dl>
      {{if eq .Gameserver.Status "running"}}
      <div class="mt-4 pt-4 border-t">
        <h4 class="text-sm font-semibold mb-2">Resource Usage</h4>
        <div class="space-y-2">
          <div>
            <div class="flex justify-between text-sm">
              <span>CPU</span>
              <span id="cpu-percent">0%</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2">
              <div id="cpu-bar" class="bg-blue-600 h-2 rounded-full" style="width: 0%"></div>
            </div>
          </div>
          <div>
            <div class="flex justify-between text-sm">
              <span>Memory</span>
              <span id="mem-usage">0.0 / 0.0 GB</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2">
              <div id="mem-bar" class="bg-green-600 h-2 rounded-full" style="width: 0%"></div>
            </div>
          </div>
        </div>
      </div>
      {{end}}
    </div>
    
    <div class="bg-white shadow rounded-lg p-6">
      <h3 class="text-lg font-semibold mb-4">Actions</h3>
      <div class="space-y-2">
        <a href="/{{.Gameserver.ID}}/edit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-md font-medium text-center block">Edit</a>
        <a href="/{{.Gameserver.ID}}/tasks" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-2 px-4 rounded-md font-medium text-center block">Scheduled Tasks</a>
        <a href="/{{.Gameserver.ID}}/files" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-2 px-4 rounded-md font-medium text-center block">File Manager</a>
        {{if eq .Gameserver.Status "running"}}
          <button hx-post="/{{.Gameserver.ID}}/stop" hx-indicator="#loading" hx-swap="none" class="w-full bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-md font-medium">Stop</button>
          <button hx-post="/{{.Gameserver.ID}}/restart" hx-indicator="#loading" hx-swap="none" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white py-2 px-4 rounded-md font-medium">Restart</button>
        {{else}}
          <button hx-post="/{{.Gameserver.ID}}/start" hx-indicator="#loading" hx-swap="none" class="w-full bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-md font-medium">Start</button>
        {{end}}
        <button hx-delete="/{{.Gameserver.ID}}" hx-confirm="Delete gameserver?" hx-indicator="#loading" hx-swap="none" class="w-full bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded-md font-medium">Delete</button>
      </div>
    </div>
  </div>
  
  {{if .Gameserver.Environment}}
  <div class="bg-white shadow rounded-lg p-6 mt-6">
    <h3 class="text-lg font-semibold mb-4">Environment Variables</h3>
    <div class="grid gap-2">
      {{range .Gameserver.Environment}}
        <div class="font-mono text-sm bg-gray-100 p-2 rounded">{{.}}</div>
      {{end}}
    </div>
  </div>
  {{end}}
  
  <div class="bg-white shadow rounded-lg p-6 mt-6">
    <h3 class="text-lg font-semibold mb-4">Logs</h3>
    <div id="logs" class="bg-black text-green-400 font-mono text-sm p-4 rounded h-96 overflow-y-auto"></div>
  </div>
</div>

<div id="loading" class="htmx-indicator fixed top-4 right-4 bg-blue-500 text-white px-4 py-2 rounded shadow-lg">Loading...</div>

<script>
const logs = document.getElementById('logs');
const eventSource = new EventSource('/{{.Gameserver.ID}}/logs');

eventSource.addEventListener('log', function(e) {
  const logLine = document.createElement('div');
  logLine.textContent = e.data;
  logs.appendChild(logLine);
  logs.scrollTop = logs.scrollHeight;
});

eventSource.addEventListener('error', function(e) {
  const errorLine = document.createElement('div');
  errorLine.textContent = 'Error: ' + e.data;
  errorLine.className = 'text-red-400';
  logs.appendChild(errorLine);
});

{{if eq .Gameserver.Status "running"}}
// Stats monitoring
const statsSource = new EventSource('/{{.Gameserver.ID}}/stats');

statsSource.addEventListener('stats', function(e) {
  const stats = JSON.parse(e.data);
  
  // Update CPU
  document.getElementById('cpu-percent').textContent = stats.cpu.toFixed(1) + '%';
  document.getElementById('cpu-bar').style.width = Math.min(stats.cpu, 100) + '%';
  
  // Update Memory
  const memPercent = stats.memoryLimitGB > 0 ? (stats.memoryUsageGB / stats.memoryLimitGB) * 100 : 0;
  document.getElementById('mem-usage').textContent = stats.memoryUsageGB.toFixed(1) + ' / ' + stats.memoryLimitGB.toFixed(1) + ' GB';
  document.getElementById('mem-bar').style.width = Math.min(memPercent, 100) + '%';
});

statsSource.addEventListener('error', function(e) {
  console.error('Stats error:', e);
});
{{end}}
</script>